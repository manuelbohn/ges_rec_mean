<!DOCTYPE html>

<html>
    <head>
        <title>My experiment</title>
        <script src="jspsych-6/jspsych.js"></script>
        <script src="jspsych-6/plugins/jspsych-html-keyboard-response.js"></script>
		<script src="jspsych-6/plugins/jspsych-image-keyboard-response.js"></script>
		<script src="jspsych-6/plugins/jspsych-video.js"></script>
		<script src="jspsych-6/plugins/jspsych-survey-text.js"></script>
		<script src="jspsych-6/plugins/jspsych-data.md"></script>
        <link href="jspsych-6/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body></body>
    <script>
		/**
		 * Randomize array element order in-place.
		 * Using Durstenfeld shuffle algorithm.
		 */
		function shuffleArray(array) {
		    for (var i = array.length - 1; i > 0; i--) {
		        var j = Math.floor(Math.random() * (i + 1));
		        var temp = array[i];
		        array[i] = array[j];
		        array[j] = temp;
		    }
		}

	/* Timeline */
	    var timeline = [];

	    /* Willommen */
	    var welcome = {
	      type: "html-keyboard-response",
	      stimulus: "</p>Herzlich willkommen zum Experiment!</p>" +
			 "</p>Um zu beginnen, klicken Sie bitte auf eine beliebige Taste.</p>",
	    };
	    timeline.push(welcome);
		
		/* VP Code */
	    var VPCode = {
	        type: 'survey-text',
	        questions: [
			{prompt: 'Was ist Ihr VPCode?', value: '', columns: 50}
	        ]
	    };
		timeline.push(VPCode)
		
		/* Instruktion */
		var instructions = {
		  type: "html-keyboard-response",
		  stimulus: "<p>Im Folgenden werden Sie eine Reihe von Videos sehen.</p> " +
		      "</p>Bitte schauen Sie sich die Videos aufmerksam an.</p> " +
		      "</p>Nach jedem Video geben Sie bitte mit einem Wort an,</p>" +
			 "</p>was die im Video verwendete Geste Ihrer Meinung nach vermutlich anzeigen soll.</p>" +  
		      "<p>Um zu beginnen, klicken Sie nun auf eine beliebige Taste.</p>",
		};
		timeline.push(instructions);

		/* Videotrials */
		var video_files = [
			'video/....mp4',
			'video/....mp4'
		]
		
		shuffleArray(video_files)
		
		for (i = 0; i < video_files.length; i++)
		{
	    	var video_trial = {
	      	  type: 'video',
	      	  width: 640,
			  height: 800,
	      	  start: 1,
	      	  stop: 1,
			  controls: true,
		      sources: [video_files[i]],
	    	}
		    var survey_block = {
		        type: 'survey-text',
		        questions: [
				{prompt: 'Was wurde Ihnen in dem Video gestikuliert?', value: '', columns: 50}
		        ]
		    };
			var repeat_trial = {
			    type: 'html-keyboard-response',
			    stimulus: 'Falls Sie sich das Video nochmal anschauen wollen, dr&uuml;cken Sie die Taste R. Um weiterzufahren dr&uuml;cken Sie bitte die Taste C.'
			};
			var loop_node = {
			    timeline: [video_trial, repeat_trial],
			    loop_function: function(data){
					console.log(data.values())
			        if(jsPsych.pluginAPI.convertKeyCharacterToKeyCode('r') == data.values()[1].key_press){
			            return true;
			        } else {
			            return false;
			        }
			    }
			};
			
			timeline.push(loop_node)
			timeline.push(survey_block)
		}
		
	    /* Verabschiedung */
		var Verabschiedung = {
		  type: "html-keyboard-response",
		  stimulus: "<p>Vielen Dank!</p> ",
		};
		timeline.push(Verabschiedung);
		
		/* Starten des Experiments */
		
		///// Ã„nderungsversuch/////
		jsPsych.init({
		  timeline: timeline,
		  on_finish: function() {
		    jsPsych.data.get().localSave("JSON");
		  }
		});
    </script>
</html>